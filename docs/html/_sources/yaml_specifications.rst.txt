YAML File Specifications
========================

This tutorial concerns the creation of a YAML file to be read by JupyterFleet.  This file will specify all the parameters used to interact with AWS, as well as optionally aid in debugging and instance monitoring.

This tutorial will *not* address the creation of an AMI in any capacity, as JupyterFleet is designed to deploy an existing AMI.  If you are affiliated with Brown and need assistance in creating an AMI, please contact our help line.


**What is a YAML file?**

A YAML file is basically a configuration file that uses an indented, hierarchical structure to make it both human-readable and machine-readable in equal measure.  It allows all options for an entire piece of software to be specified in one place without having to type out a ten-line command on the command line that is difficult to read and annoying to edit.

YAML files can be formatted in a number of ways; the exact specifications for the YAML file that JupyterFleet can read are outlined below.  A sample YAML file can be found at placeholder.

**JupyterFleet YAML Format**

instance-creation
''''''''''''''''''



platform
........

The 'platform' option is used to specify the platform JupyterFleet is being run from - not the platform of the AMI.  This information is used to configure logging in the event that you elect to enable logging, as platform determines the location of the crontab (system tool for running a task at a designated interval) configuration file.



aws-credentials
...............

**generate-configuration**

The 'generate-configuration' option is used to designate whether JupyterFleet should configure the AWS Command Line Interface (CLI).  The CLI must be configured to use JupyterFleet, but this option can be set to FALSE if you have already configured the tool yourself.  Importantly, the default region must be set to the region in which the instances are to be deployed (and the AMI must be in that region too).  The rest of the options under 'aws-credentials' will only be used if 'generate-configuration' is set to TRUE.

**default-region**

The 'default-region' option is used to specify the region to be used in deploying the instances.  The AMI to be used must be available in this region.

**key-id**

The 'key-id' option is used to specify your AWS key ID.

**secrey-key**

The 'secret-key' option is used to specify your AWS key ID.



cli-parameters
..............

**ami-id**

The 'ami-id' option is used to specify the AMI ID - *not* the AMI's name.  This ID can be found on the 'AMIs' page linked in the left toolbar on the main EC2 page.

[EC2 screenshot with the AMIs page highlighted]

Within that page, the AMI ID corresponding to your AMI of choice can be found in the column bearing that name.

[AMIs page with the AMI ID column highlighted]

**instance-type**

The 'instance-type' option is used to designate what type of EC2 instance to use.  A list of available instance types and their capabilities can be found on Amazon's `EC2 page <https://aws.amazon.com/ec2/instance-types/>`_.  We have found that the 't2.medium' instance type affords the best balance of cost and performance for an interactive workshop (as jobs that require significant memory will take too long to be demonstrated in this format), though the choice will necessarily be dictated by use case.

Please be mindful of the fact that each instance type is governed by its own instance limit, and be sure that the instance you've selected has a limit greater than or equal to the number of instances you plan to deploy.

**instance-number**

The 'instance-number' option is used to specify the number of instances - and thereby the number of notebooks - to instantiate.

**security-group-id**

The 'security-group-id' option is used to designate which security group to attach to the instances.  As in the case of 'ami-id', this option uses the security group's ID, not its name.  The security group ID can be found on the 'Security Groups' page linked in the left toolbar on the main EC2 page.

[EC2 screenshot with the Security Groups page highlighted]

Within that page, the security group ID corresponding to your security group of choice can be found in the 'Group ID' column.

[Security Groups page with the Group ID column highlighted]

**keyfile**

*key-path*

The 'key-path' option is used to designate the location of the folder containing the .pem keyfile used to connect to AWS instances.  A keypair must first be created; this task can be performed by going into the 'Keypairs' page using the left toolbar on the main EC2 page and then selecting 'Create Key Pair'.  More details about creating keypairs is beyond the scope of this tutorial and can be found in the AWS documentation.

By convention, keyfiles are stored in the '.ssh' hidden subdirectory of the user's home directory i.e. ~/.ssh - this option should specify the directory's path not including the name of the keyfile itself, which is specified immediately below.

*key-name*

The 'key-name' option is used to designate the name of the keyfile itself.


instance-configuration
''''''''''''''''''''''

Add directory information here once it is implemented and make this less huge
=============================================================================

verbosity
.........

The 'verbosity' option is used to control whether or not the software outputs each IP before it connects to it to activate the Jupyter server.  It will probably do other things later as well.

logging
.......

**cron-interval**

The 'cron-interval' option is used to determine how frequently, in minutes, the instances will be checked and their screen statuses logged.  Setting this interval to 0 will disable logging entirely.

**log-directory**

The 'log-directory' option is used to designate where the log file will be written.  Setting the option '.' will cause the logs to be placed in the current directory.

**wait**

The 'wait' option is used to force the software to wait for 120 seconds after activating Jupyter and then check the status of screens on that instance; this test is conducted on every instance.  If there is an error with the activation of the Jupyter server, the screen will almost certainly die during that interval, meaning that no screens will be visible when the query is executed.  If no screens are visible, there is likely a problem with the AMI that must be addressed (or a misspecification of the 'conda-path' option described below).  *This option is intended for small-scale testing purposes only, as it adds two minutes to the configuration of every instance, increasing the spin-up time by hours for a full-scale deployment.*

username
........

The 'username' option is used to specify the username of the root user on the AMI (the username you used to login to the instance you used to generate the AMI).  This value will depend entirely on the AMI you have created (e.g. any AMI built from the default Ubuntu base image will be 'ubuntu').

conda-path
..........

The 'conda-path' option is used to specify the full filepath to the conda binary folder within the AMI.  If this path is misspecified, attempts to activate the Jupyter server will fail and the screen will die - you can monitor for this problem by enabling the 'wait' option under 'logging' as described above.

jupyter-port
....

The 'jupyter-port' option is used to specify which port the Jupyter server is exposed on (as specified in the Jupyter configuration file on the AMI).  This option is used to generate the list of instance links and the user directory and does not ameliorate a misconfigured security group (i.e. even if 'jupyter-port' is listed correctly, Jupyter will be inaccessible if the wrong security group is applied to the instances).  Likewise, if the security group is correct but 'jupyter-port' is wrong, Jupyter itself will work fine but the directory will be populated by dead links.